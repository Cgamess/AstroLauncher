<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Astronner Server Status</title>
    <style>
      * {
        font-family: Arial;
      }

      table,
      tr,
      td,
      th {
        border: 1px solid black;
        border-collapse: collapse;
        text-align: left;
        padding: 3px;
      }

      .error {
        color: red;
      }
    </style>
  </head>

  <body>
    <h1>Dedicated Server Status for <span id="titleIP">[IP]</span></h1>
    <p id="msg" class="error"></p>

    <h3>
      Statistics
    </h3>
    <p>Server Name: <span id="serverName"></span></p>
    <p>Owner: <span id="owner"></span></p>
    <p>Max Server Framerate: <span id="maxFramerate"></span></p>
    <p>Maxium PLayers: <span id="maxPLayers"></span></p>
    <p>Players online: <span id="onlinePLayers"></span></p>
    <br />

    <h3>
      Players
    </h3>
    <table id="players">
      <tr>
        <th>Name</th>
        <th>Role</th>
        <th>In Game</th>
      </tr>
    </table>

    <!--<p>
      : <span id=""></span>
    </p>-->
  </body>

  <script>
    console.log("Hi there! Feel to explore the code!");

    $ = document.querySelector.bind(document);
    let data = {};

    const init = async () => {
      try {
        let res = await fetch("/api");
        data = await res.json();

        console.log(data);

        s = data.settings;

        $("#titleIP").innerHTML = `${s.PublicIP}:${s.Port}`;

        $("#serverName").innerHTML = s.ServerName;
        $("#owner").innerHTML = s.OwnerName;
        $("#maxFramerate").innerHTML = s.MaxServerFramerate;

        $("#maxPlayers").innerHTML = s.MaximumPlayerCount;
        $("#onlinePlayers").innerHTML = data.players.playerInfo.filter(
          (p) => p.inGame
        ).length;

        if (data.players) {
          data.players.playerInfo.forEach((p) => {
            let row = document.createElement("tr");
            row.innerHTML = `<td>${p.playerName}</td>
          <td>${p.playerCategory}</td>
          <td>${p.inGame}</td>`;

            $("#players").appendChild(row);
          });
        } else {
          $("#players").innerHTML = "Error getting player data";
        }
      } catch (e) {
        $("#msg").innerHTML = "ERROR! Try again in 10s";
      }
    };

    init();
  </script>
</html>
